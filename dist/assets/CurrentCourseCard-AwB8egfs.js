import{l as R,r as m,A as T,n as H,o as Q,f as x,j as e,T as l,B as f,k as c,P as W,a6 as Z}from"./index-BLDXZsNf.js";import{g as V,a as _,b as $,_ as G,s as Y}from"./getStudentLessons-9oxf_aXv.js";import{s as J}from"./setStudentProgramFavorite-WRttFheY.js";import{g as U}from"./getTeacherDataFromProgram-st-c01_H.js";import{g as X,a as ee,b as te}from"./getQuizzesData-LrFtBJND.js";import{g as ne}from"./getCoursesData-bKJQ8hIk.js";import{g as ie}from"./getProgramFinalExams-5NZ9maXk.js";import{g as se}from"./getStudentProgramFinalExams-vPSFFfCN.js";import{A as oe,a as de,b as le}from"./AccordionSummary-zqxAlL-z.js";import"./index-_pDSIHrO.js";function je(t){const L=R(),{userData:i}=m.useContext(T),[u,D]=m.useState(!1),M=H();function P(n){n.target instanceof HTMLInputElement||n.target instanceof HTMLButtonElement||n.target instanceof HTMLParagraphElement||n.target instanceof SVGElement||D(y=>!y)}const K=async()=>{await J(i.id,t.id),L.invalidateQueries({queryKey:["userData"]})},{mutate:N}=Q({onMutate:()=>{const n=L.getQueryData(["userData"]);return L.setQueryData(["userData"],y=>{const s=y.favoritePrograms;let o;return s.length?o=s.includes(t.id)?s.slice().filter(r=>r!==t.id):[...s,t.id]:o=[t.id],{...y,favoritePrograms:o}}),()=>L.setQueryData(["userData"],n)},mutationFn:()=>K()}),{data:d}=x({queryKey:["teacherData",t.id],queryFn:()=>U(t),refetchOnMount:!1,enabled:u}),{data:B}=x({queryKey:["preReqData",t.id],queryFn:()=>getProgramsData(t.prerequisites),enabled:!!u}),{data:w}=x({queryKey:["courses",t==null?void 0:t.id,"currentCard"],queryFn:()=>ne(t),refetchOnMount:!0,enabled:!!u}),{data:F}=x({queryKey:["assessments",t.id,"currentCard"],queryFn:()=>X(w),enabled:!!w,refetchOnMount:!0}),{data:j}=x({queryKey:["lessons",t.id,"currentCard"],queryFn:()=>ee(w._id,w.programId),enabled:!!w,refetchOnMount:!0}),{data:b}=x({queryKey:["quizzes",t.id,"currentCard"],queryFn:()=>te(w),enabled:!!w,refetchOnMount:!0}),{data:S}=x({queryKey:["studentLesson",i==null?void 0:i.id,"currentCard",t.id],queryFn:()=>V(i==null?void 0:i.id,j==null?void 0:j.map(n=>n.id)),enabled:!!j}),{data:I}=x({queryKey:["studentAssessment",i==null?void 0:i.id,"currentCard",t.id],queryFn:()=>_(i==null?void 0:i.id,F==null?void 0:F.map(n=>n.id)),enabled:!!F}),{data:v}=x({queryKey:["studentQuizzes",i==null?void 0:i.id,"currentCard",t.id],queryFn:()=>$(i==null?void 0:i.id,b==null?void 0:b.map(n=>n.id)),enabled:!!b}),{data:p}=x({queryKey:["finalExams",t.id],queryFn:()=>ie(t.id),enabled:u}),{data:q}=x({queryKey:["finalExams",t.id,i.id],queryFn:()=>se(i.id,Object.values((t==null?void 0:t.finalExams)??[""])),enabled:u}),a=m.useMemo(()=>{var n;if(t!=null&&t.finalExams){const s=((n=Object.keys(t==null?void 0:t.finalExams))==null?void 0:n.sort((o,r)=>Number(o.split(" ")[1])-Number(r.split(" ")[1]))).map(o=>{const r=p==null?void 0:p.find(g=>g.id===(t==null?void 0:t.finalExams[o]));return q==null?void 0:q.find(g=>{var h;return((h=p==null?void 0:p.map(C=>C.id))==null?void 0:h.includes(g.finalExamId))&&(r==null?void 0:r.id)===g.finalExamId})});return s.sort((o,r)=>Number(r==null?void 0:r.grade)-Number(o==null?void 0:o.grade)),s[0]}},[p,q,t]),E=m.useMemo(()=>{if(u)return((F==null?void 0:F.length)??[].length)+((j==null?void 0:j.length)??[].length)+((b==null?void 0:b.length)??[].length)},[F,j,b,u]),z=m.useMemo(()=>{if(u){const n=I==null?void 0:I.slice().reduce((s,o)=>{const{assessmentId:r,createdAt:g}=o,h=s.findIndex(C=>C.assessmentId===r);if(h===-1)s.push(o);else{const C=s[h].createdAt;new Date(g)>new Date(C)&&(s[h]=o)}return s},[]),y=v==null?void 0:v.slice().reduce((s,o)=>{const{quizId:r,createdAt:g}=o,h=s.findIndex(C=>C.quizId===r);if(h===-1)s.push(o);else{const C=s[h].createdAt;new Date(g)>new Date(C)&&(s[h]=o)}return s},[]);return((n==null?void 0:n.length)??0)+((S==null?void 0:S.length)??0)+((y==null?void 0:y.length)??0)}},[I,S,v,u]),A=m.useMemo(()=>E!==0?(z/E*100).toFixed():0,[E,z]),k=B==null?void 0:B.map(n=>e.jsx(l,{sx:{textDecoration:"underline"},fontSize:18,fontFamily:"Inter",fontWeight:400,children:n==null?void 0:n.name})),O=i.favoritePrograms.length&&i.favoritePrograms.includes(t.id)?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"20",viewBox:"0 0 21 20",fill:"none",children:e.jsx("path",{d:"M6.14963 19.1713C4.44636 20.0668 2.90407 18.9476 3.22957 17.0498L3.99423 12.5915L0.755079 9.43408C-0.622893 8.09089 -0.0350361 6.27823 1.87044 6.00135L6.34684 5.35089L8.34874 1.2946C9.20037 -0.431002 11.106 -0.432061 11.9581 1.2946L13.96 5.35089L18.4364 6.00135C20.3407 6.27806 20.9306 8.09007 19.5518 9.43408L16.3126 12.5915L17.0773 17.0498C17.4026 18.9464 15.8616 20.0673 14.1572 19.1713L10.1534 17.0664L6.14963 19.1713Z",fill:"#FF7E00"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"20",viewBox:"0 0 21 20",fill:"none",children:e.jsx("path",{d:"M6.14963 19.1713C4.44636 20.0668 2.90407 18.9476 3.22957 17.0498L3.99423 12.5915L0.755079 9.43408C-0.622893 8.09089 -0.0350361 6.27823 1.87044 6.00135L6.34684 5.35089L8.34874 1.2946C9.20037 -0.431002 11.106 -0.432061 11.9581 1.2946L13.96 5.35089L18.4364 6.00135C20.3407 6.27806 20.9306 8.09007 19.5518 9.43408L16.3126 12.5915L17.0773 17.0498C17.4026 18.9464 15.8616 20.0673 14.1572 19.1713L10.1534 17.0664L6.14963 19.1713ZM9.22844 15.0107C9.77849 14.7215 10.5263 14.7204 11.0784 15.0107L14.7783 16.9559L14.0717 12.836C13.9667 12.2235 14.1967 11.5119 14.6434 11.0765L17.6367 8.15877L13.5001 7.55768C12.8851 7.46832 12.2795 7.02965 12.0034 6.47029L10.1534 2.72187L8.30348 6.47029C8.02846 7.02755 7.4241 7.46799 6.80681 7.55768L2.67018 8.15877L5.66347 11.0765C6.10847 11.5103 6.3406 12.2211 6.23515 12.836L5.52853 16.9559L9.22844 15.0107Z",fill:"#FF7E00"})});return e.jsxs(oe,{expanded:u,TransitionProps:{unmountOnExit:!0},sx:{".css-97ovai":{},marginY:4,border:"0px",boxShadow:"none",background:"#FFFBF8",".css-o4b71y-MuiAccordionSummary-content":{margin:0},".css-1bh1d34-MuiPaper-root-MuiAccordion-root":{borderRadius:"20px"}},children:[e.jsx(de,{sx:{padding:0,margin:"0 !important",boxShadow:"none"},children:e.jsxs(f,{p:3,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",bgcolor:"#FFFBF8",m:0,width:"100%",onClick:n=>P(n),children:[e.jsxs(c,{direction:"column",gap:2,bgcolor:"#FFFBF8",width:{xs:"40%",sm:"40%",lg:"30%"},children:[e.jsxs(c,{alignItems:"center",justifyContent:"space-between",direction:"row",children:[e.jsx(l,{fontSize:26,fontWeight:900,fontFamily:"Inter",children:t==null?void 0:t.name}),e.jsx(W,{onClick:()=>N(),sx:{fontSize:24},children:O})]}),e.jsxs(c,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(l,{fontSize:16,fontWeight:400,fontFamily:"Inter",children:t.category}),e.jsxs(c,{direction:"row",gap:1,alignItems:"center",justifyContent:"center",children:[e.jsx(W,{sx:{fontSize:20},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"15",viewBox:"0 0 16 15",fill:"none",children:e.jsx("path",{d:"M7.72751 0.779696C7.89978 0.258006 8.63774 0.258004 8.81001 0.779694L10.2205 5.05112C10.2976 5.28465 10.5158 5.44239 10.7618 5.44239H15.3064C15.8608 5.44239 16.0889 6.15367 15.6379 6.47609L11.9772 9.09309C11.7741 9.23822 11.6891 9.49854 11.7674 9.73552L13.1694 13.9812C13.3423 14.5047 12.7452 14.9443 12.2967 14.6236L8.60025 11.9811C8.40198 11.8394 8.13554 11.8394 7.93727 11.9811L4.24085 14.6236C3.79234 14.9443 3.19523 14.5047 3.36811 13.9812L4.77012 9.73552C4.84837 9.49854 4.76337 9.23822 4.56036 9.09309L0.899615 6.47609C0.448606 6.15367 0.676701 5.44239 1.2311 5.44239H5.77575C6.02168 5.44239 6.23988 5.28465 6.317 5.05112L7.72751 0.779696Z",fill:"#FF9F06"})})}),e.jsx(l,{fontSize:16,fontFamily:"Poppins",fontWeight:700,sx:{color:"#004643"},children:t.averageRating}),e.jsxs(l,{fontFamily:"Inter",fontSize:16,fontWeight:400,ml:.5,children:["(",t.totalFeedbacks,")"]})]})]})]}),e.jsx(c,{width:{xs:"40%",sm:"40%",lg:"30%"},children:e.jsx(l,{fontSize:18,fontWeight:400,fontFamily:"Inter",children:t.description})})]})}),e.jsx(le,{sx:{padding:0},children:e.jsxs(f,{mt:4,children:[e.jsxs(c,{flexWrap:"wrap",gap:{xs:2,sm:2,lg:6},direction:"row",pl:6,pb:2,children:[e.jsx(l,{fontSize:18,fontFamily:"Inter",fontWeight:600,children:"Prerequisites:"}),k]}),e.jsxs(f,{px:6,pl:10,bgcolor:"#fff",py:4,children:[e.jsx(l,{fontSize:18,fontFamily:"Inter",fontWeight:600,children:"Taught By:"}),e.jsxs(c,{ml:2,direction:"row",justifyContent:"space-between",children:[e.jsxs(c,{direction:"row",gap:2,mt:4,alignItems:"center",children:[e.jsx(Z,{onClick:()=>M(`/teacherprofile/${d==null?void 0:d.id}`),src:d==null?void 0:d.image,sx:{width:"70px",height:"70px",cursor:"pointer"}}),e.jsxs(c,{direction:"column",justifyContent:"center",gap:.5,children:[e.jsxs(l,{onClick:()=>M(`/teacherprofile/${d==null?void 0:d.id}`),sx:{color:"#000",cursor:"pointer"},fontFamily:"Inter",fontSize:12,fontWeight:600,children:[d==null?void 0:d.name," | ",d==null?void 0:d.title]}),e.jsxs(c,{direction:"row",justifyContent:"space-between",gap:1,children:[e.jsx(l,{fontFamily:"Inter",fontSize:12,fontWeight:500,children:d==null?void 0:d.university}),e.jsx(c,{direction:"row",alignItems:"center",gap:.5})]})]})]}),e.jsxs(c,{direction:"column",children:[a&&e.jsxs(f,{sx:{position:"relative"},alignSelf:"flex-end",children:[e.jsx(G,{options:{chart:{type:"donut"},colors:["#fff","#FF9F06"],legend:{show:!1},dataLabels:{enabled:!1}},series:[100-Number(a.grade),Number(a.grade)],type:"donut",width:"120px"}),e.jsx("img",{src:Y,width:"40px",height:"40px",style:{position:"absolute",top:18,left:40.5}}),e.jsxs(l,{fontSize:12,style:{position:"absolute",top:30,left:45},sx:{color:"#fff"},children:[Number(a==null?void 0:a.grade)!==100?Number(a==null?void 0:a.grade).toFixed(1):Number(a==null?void 0:a.grade).toFixed(0),"%"]})]}),e.jsxs(c,{direction:"column",alignItems:"flex-start",width:"510px",gap:1,children:[e.jsx(l,{fontSize:10,fontWeight:500,fontFamily:"Inter",children:"Progress Bar"}),e.jsx(f,{border:"1px solid #6A9DBC",height:"15px",width:"80%",bgcolor:"#D0EBFC",position:"relative",children:e.jsx(f,{width:`${A}%`,height:"100%",bgcolor:"#6A9DBC",position:"relative",display:"flex",justifyContent:"flex-end",alignSelf:"center",children:e.jsx(f,{height:"22px",width:"5px",bgcolor:"#FF7E00",mt:"-3.5px",position:"relative",children:e.jsxs(l,{sx:{color:"#FF7E00"},position:"absolute",top:"98%",left:"-100%",fontSize:12,fontFamily:"Inter",fontWeight:600,children:[A,"%"]})})})})]})]})]}),e.jsxs(c,{direction:"row",gap:1,flexWrap:"wrap",mt:7,ml:-6,children:[e.jsx(f,{bgcolor:"#D0EBFC",sx:{border:"1.5px solid",borderRadius:"20px",borderColor:"#6A9DBC"},px:1.5,py:.5,children:e.jsx(l,{fontSize:12,fontWeight:400,fontFamily:"Inter",children:t==null?void 0:t.duration})}),e.jsx(f,{bgcolor:"#D0EBFC",sx:{border:"1.5px solid",borderRadius:"20px",borderColor:"#6A9DBC"},px:1.5,py:.5,children:e.jsx(l,{fontSize:12,fontWeight:400,fontFamily:"Inter",children:"Completion Certificate"})}),e.jsx(f,{bgcolor:"#D0EBFC",sx:{border:"1.5px solid",borderRadius:"20px",borderColor:"#6A9DBC"},px:1.5,py:.5,children:e.jsx(l,{fontSize:12,fontWeight:400,fontFamily:"Inter",children:t==null?void 0:t.level})}),e.jsx(f,{bgcolor:"#D0EBFC",sx:{border:"1.5px solid",borderRadius:"20px",borderColor:"#6A9DBC"},px:1.5,py:.5,children:e.jsx(l,{fontSize:12,fontWeight:400,fontFamily:"Inter",children:t==null?void 0:t.expiry})})]})]})]})})]})}export{je as default};
