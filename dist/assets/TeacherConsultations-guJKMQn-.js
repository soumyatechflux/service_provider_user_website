import{U as L,V as P,W as H,X as q,D as W,ab as X,C as N,F as U,Q as V,l as O,r as g,A as Q,f as R,o as A,j as e,k as f,a4 as z,S as I,a5 as v,M as u,B as y,T as p,I as Z,a as D,q as F,a6 as K,P as $}from"./index-BLDXZsNf.js";import{d as G}from"./ExpandMore-uAOPnDwe.js";import{s as B,a as J}from"./setRescheduleConsultation-yyQ7rzss.js";const _=async c=>{const n=L(W,"consultationSessions"),a=P(n,H("teacherId","==",c));return(await q(a)).docs.map(x=>({...x.data(),id:x.id}))},Y=async c=>{const n=L(W,"students"),a=P(n,H(X(),"in",c));return(await q(a)).docs.map(x=>({...x.data(),id:x.id}))},ee=async c=>{const n=L(W,"teacherSchedule"),a=P(n,H("teacherId","==",c)),o=await q(a);if(o.docs.length>0)return{...o.docs[0].data(),id:o.docs[0].id}},te=async(c,n,a,o)=>{const h=N(W,"teacherSchedule",c),S={...(await U(h)).data(),numberOfDays:n,slots:a.slice(0,n),hourlyRate:o};await V(h,S)},ne=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],k=["12 AM","1 AM","2 AM","3 AM","4 AM","5 AM","6 AM","7 AM","8 AM","9 AM","10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM","7 PM","8 PM","9 PM","10 PM","11 PM"],oe=/^\d*\.?\d{0,2}$/;function ie({setEdit:c}){const n=O(),{userData:a}=g.useContext(Q),{data:o,isSuccess:h}=R({queryKey:["teacherSchedule",a==null?void 0:a.id],queryFn:()=>ee(a==null?void 0:a.id),enabled:!!a}),[x,S]=g.useState(Number(o==null?void 0:o.numberOfDays)??0),[s,j]=g.useState([{day:"",startTime:"",endTime:""}]),[T,M]=g.useState(o==null?void 0:o.hourlyRate);function w(r,l,i){const d={...s[l]??{endTime:"",startTime:"",day:""},[i]:r.target.value},C=s[l]?[...s]:[...s,{endTime:"",startTime:"",day:""}];C[l]=d,j(C)}g.useEffect(()=>{h&&(S(Number(o==null?void 0:o.numberOfDays)),j(o==null?void 0:o.slots))},[h]);const{mutate:m}=A({onMutate:async()=>{const r=n.getQueryData(["teacherSchedule",a==null?void 0:a.id]);return n.setQueryData(["teacherSchedule",a==null?void 0:a.id],l=>({...l,numberOfDays:x,slots:s.slice(0,x)})),()=>n.setQueryData(["teacherSchedule",a==null?void 0:a.id],r)},mutationFn:()=>te(o==null?void 0:o.id,x,s,T)}),t=g.useMemo(()=>{var l;const r=[];for(let i=0;i<x;i++){const b=e.jsxs(f,{alignItems:"center",justifyContent:"center",gap:2,children:[e.jsxs(f,{direction:"column",gap:.65,children:[e.jsxs(z,{sx:{color:"#000",fontSize:16,fontFamily:"Inter",fontWeight:600},id:"noOfDays",children:["Day ",i+1]}),e.jsx(I,{sx:{width:"140px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F",textAlign:"center"},IconComponent:()=>e.jsx(v,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"70%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,color:"primary",labelId:"noOfDays",value:s[i]?s[i].day:"",defaultValue:((l=o==null?void 0:o.slots)==null?void 0:l.length)>=i+1&&(o==null?void 0:o.slots[i].day),onChange:d=>w(d,i,"day"),children:ne.map(d=>e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:d,children:d},d))})]}),e.jsxs(f,{direction:"column",gap:.65,children:[e.jsx(z,{sx:{color:"#000",fontSize:14,fontFamily:"Inter",fontWeight:500},id:"noOfDays",children:"Starting"}),e.jsx(I,{value:s[i]?s[i].startTime:"",sx:{width:"140px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F",textAlign:"center"},IconComponent:()=>e.jsx(v,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"70%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,onChange:d=>w(d,i,"startTime"),children:k.map(d=>e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:d,children:d},d))})]}),e.jsxs(f,{direction:"column",gap:.65,children:[e.jsx(z,{sx:{color:"#000",fontSize:14,fontFamily:"Inter",fontWeight:500},id:"noOfDays",children:"Ending"}),e.jsx(I,{value:s[i]?s[i].endTime:"",sx:{width:"140px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F",textAlign:"center"},IconComponent:()=>e.jsx(v,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"70%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,onChange:d=>w(d,i,"endTime"),children:k.map((d,C)=>e.jsx(u,{disabled:s[i]?k.indexOf(s[i].startTime)>=C:!1,sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:d,children:d},d))})]})]},i);r.push(b)}return r},[x,o,s]);return e.jsx(y,{mx:14,borderRadius:"20px",overflow:"hidden",height:"auto",boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.25)",bgcolor:"#D0EBFC",px:5,children:e.jsxs(y,{display:"flex",flexDirection:"column",py:4,gap:4,children:[e.jsxs(f,{direction:"row",flex:1,justifyContent:"space-between",children:[e.jsxs(f,{direction:"column",gap:.65,children:[e.jsx(z,{sx:{color:"#000",fontSize:16,fontFamily:"Inter",fontWeight:600},id:"noOfDays",children:"# of Days"}),e.jsxs(I,{sx:{width:"140px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F",textAlign:"center"},IconComponent:()=>e.jsx(v,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"70%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,color:"primary",labelId:"noOfDays",value:x,onChange:r=>S(Number(r.target.value)),children:[e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"1",children:"1"}),e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"2",children:"2"}),e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"3",children:"3"}),e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"4",children:"4"}),e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"5",children:"5"}),e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:"6",children:"6"})]})]}),e.jsxs(f,{gap:1,justifyContent:"center",alignItems:"center",children:[e.jsx(p,{sx:{color:"#000",fontSize:16,fontFamily:"Inter",fontWeight:600},children:"Hourly Rate (usd/hr)"}),e.jsx(Z,{sx:{width:"140px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F",textAlign:"center"},disableUnderline:!0,value:T,onChange:r=>oe.test(r.target.value)&&M(r.target.value)})]})]}),e.jsx(y,{height:"auto",display:"flex",gap:2,flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",children:t}),e.jsxs(f,{flex:1,justifyContent:"flex-end",gap:3,direction:"row",mt:1,children:[e.jsx(D,{sx:{width:"120px",height:"35px",background:"#fff",color:"#226E9F",fontFamily:"Inter",fontSize:14,textTransform:"none",fontWeight:500,border:"1px solid #226E9F",borderRadius:"8px","&:hover":{background:"#fff",opacity:1}},onClick:()=>c(r=>!r),children:"Cancel"}),e.jsx(D,{sx:{width:"120px",height:"35px",background:"#6A9DBC",color:"#fff",fontFamily:"Inter",fontSize:14,textTransform:"none",fontWeight:500,border:"1px solid #6A9DBC",borderRadius:"8px","&:hover":{background:"#6A9DBC",opacity:1}},onClick:()=>{c(r=>!r),m()},children:"Confirm"})]})]})})}const E=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function de(){const c=O(),{userData:n}=g.useContext(Q),[a,o]=g.useState(!1),[h,x]=g.useState(E[F.now().toDate().getDay()]),S=g.useMemo(()=>{const t=F.now().toDate(),r=t.getDay(),i=(E.indexOf(h)-r+7)%7;return t.setDate(t.getDate()+i),t},[h]),{data:s}=R({queryKey:["teacherConsultations",n==null?void 0:n.id],queryFn:()=>_(n==null?void 0:n.id),enabled:!!(n!=null&&n.id)}),{data:j}=R({queryKey:["studentsData",n==null?void 0:n.id],queryFn:()=>Y(s==null?void 0:s.map(t=>t==null?void 0:t.studentId)),enabled:!!s}),{mutate:T}=A({onMutate:t=>{const r=c.getQueryData(["teacherConsultations",n==null?void 0:n.id]);return c.setQueryData(["teacherConsultations",n==null?void 0:n.id],l=>l?l.slice().filter(b=>b.id!==t):[]),()=>c.setQueryData(["teacherConsultations",n==null?void 0:n.id],r)},mutationFn:t=>B(t)}),{mutate:M}=A({onMutate:t=>{const r=c.getQueryData(["teacherConsultations",n==null?void 0:n.id]);return c.setQueryData(["teacherConsultations",n==null?void 0:n.id],l=>l?l.slice().filter(b=>b.id!==t):[]),()=>c.setQueryData(["teacherConsultations",n==null?void 0:n.id],r)},mutationFn:t=>J(t)}),w=t=>{window.location.href=t};g.useEffect(()=>{(async()=>{if(s){const l=s.slice().filter(i=>{var C;const b=F.now().seconds-((C=i==null?void 0:i.endTime)==null?void 0:C.seconds),d=7*24*60*60;return b>=d}).map(async i=>{await B(i.id)});await Promise.all(l)}})()},[s]);const m=s==null?void 0:s.slice().filter(t=>t.status==="accepted").filter(t=>t.startTime.toDate().getDate()===S.getDate()).map(t=>{const r=j==null?void 0:j.find(l=>l.id===(t==null?void 0:t.studentId));return e.jsxs(y,{display:"flex",flexDirection:"column",justifyContent:"space-between",px:3,py:1,bgcolor:"#D0EBFC",borderRadius:"10px",overflow:"hidden",boxShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.25)",children:[e.jsxs(f,{direction:"row",gap:1,mr:7,children:[e.jsx(K,{src:r==null?void 0:r.image,sx:{width:"41px",height:"41px",border:"1px solid #226E9F",cursor:"pointer"}}),e.jsxs(f,{direction:"column",justifyContent:"center",gap:.5,children:[e.jsx(p,{sx:{color:"#226E9F",cursor:"pointer"},fontFamily:"Inter",fontSize:12,fontWeight:600,children:r==null?void 0:r.name}),e.jsx(p,{fontFamily:"Inter",fontSize:10,fontWeight:400,children:"Software Engineer | Cairo, Egypt"})]})]}),e.jsxs(f,{direction:"row",justifyContent:"space-between",mt:4,mb:3,children:[e.jsx(p,{fontSize:14,fontWeight:500,fontFamily:"Inter",children:t.startTime.toDate().toLocaleDateString("en-GB")}),e.jsxs(f,{direction:"row",alignItems:"center",children:[e.jsx(p,{fontSize:16,fontWeight:600,fontFamily:"Inter",children:t.startTime.toDate().getHours()>12?t.startTime.toDate().getHours()%12:t.startTime.toDate().getHours()}),e.jsxs(p,{sx:{marginTop:"5px"},fontSize:8,fontWeight:400,fontFamily:"Inter",children:[t.startTime.toDate().getHours()>12?"PM":"AM","-"]}),e.jsx(p,{fontSize:16,fontWeight:600,fontFamily:"Inter",children:t.endTime.toDate().getHours()>12?t.endTime.toDate().getHours()%12:t.endTime.toDate().getHours()}),e.jsx(p,{sx:{marginTop:"5px"},fontSize:8,fontWeight:400,fontFamily:"Inter",children:t.endTime.toDate().getHours()>12?"PM":"AM"})]})]}),F.now().toDate()>=t.startTime.toDate()&&F.now().toDate()<=t.endTime.toDate()?e.jsx(f,{width:"140px",alignSelf:"center",mb:1,children:e.jsx(D,{sx:{padding:.5,border:"0px",background:"#00B227",color:"#fff",paddingX:1},onClick:()=>w(t==null?void 0:t.meetingLink),children:e.jsx(p,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:400,fontFamily:"Inter",children:"Join Consultation"})})}):e.jsxs(f,{mb:1,direction:"row",justifyContent:"space-between",children:[e.jsx(D,{sx:{padding:.5,border:"0px",background:"#226E9F",color:"#fff",paddingX:1,width:"100px"},onClick:()=>M(t.id),children:e.jsx(p,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:400,fontFamily:"Inter",children:"Reschedule"})}),e.jsx(D,{sx:{padding:.5,border:"0px",background:"#D9D9D9",color:"#000",paddingX:1,width:"70px"},onClick:()=>T(t.id),children:e.jsx(p,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:500,fontFamily:"Inter",children:"Cancel"})})]})]})});return e.jsx(e.Fragment,{children:a?e.jsx(ie,{setEdit:o}):e.jsxs(y,{mx:14,borderRadius:"20px",overflow:"hidden",height:"auto",boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.25)",children:[e.jsxs(y,{p:2,px:4,bgcolor:"#D0EBFC",display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(p,{fontWeight:900,fontFamily:"Inter",fontSize:24,children:"Consultations"}),e.jsx($,{onClick:()=>o(t=>!t),sx:{cursor:"pointer"},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"27",height:"25",viewBox:"0 0 27 25",fill:"none",children:[e.jsx("rect",{width:"27",height:"25",rx:"5",fill:"white"}),e.jsx("path",{d:"M22.1835 11.238C21.7321 11.238 21.366 11.604 21.366 12.0554V19.5213C21.366 20.5377 20.5395 21.3651 19.5223 21.3651H6.47956C5.46231 21.3651 4.63579 20.5377 4.63579 19.5213V6.47866C4.63579 5.46231 5.46231 4.63488 6.47956 4.63488H14.0354C14.4868 4.63488 14.8529 4.26885 14.8529 3.81744C14.8529 3.36603 14.4868 3 14.0354 3H6.47956C4.56131 3 3 4.5604 3 6.47866V19.5213C3 21.4396 4.56131 23 6.47956 23H19.5223C21.4405 23 23.0018 21.4396 23.0018 19.5213V12.0554C23.0018 11.604 22.6349 11.238 22.1835 11.238Z",fill:"#226E9F"}),e.jsx("path",{d:"M17.4441 3.82134L10.1716 11.0938C9.61938 11.6451 9.35145 12.4281 9.44681 13.2019L9.42774 15.7487C9.42683 15.9676 9.51312 16.1783 9.66752 16.3327C9.82102 16.4862 10.029 16.5725 10.2461 16.5725C10.2479 16.5725 10.2506 16.5725 10.2524 16.5725L12.7992 16.5534C13.5694 16.6488 14.3551 16.3817 14.9064 15.8295L22.1798 8.55704C22.633 8.10381 22.8864 7.50345 22.8937 6.86676C22.9019 6.2237 22.6566 5.61971 22.2052 5.16921L20.8319 3.79682C19.9037 2.86857 18.3841 2.88129 17.4441 3.82134ZM21.2579 6.84677C21.2561 7.05386 21.1716 7.25004 21.0217 7.39991L13.7484 14.6724C13.5458 14.874 13.2615 14.9721 12.9736 14.9267C12.9318 14.9203 12.891 14.9176 12.8492 14.9176C12.8474 14.9176 12.8446 14.9176 12.8428 14.9176L11.0681 14.9312L11.0817 13.1556C11.0817 13.112 11.0781 13.0693 11.0717 13.0257C11.0281 12.7423 11.1235 12.4517 11.326 12.25L18.5985 4.97756C18.9037 4.67511 19.3851 4.6624 19.6757 4.95122L21.049 6.32361C21.1861 6.46167 21.2606 6.64696 21.2579 6.84677Z",fill:"#226E9F"})]})})]}),e.jsxs(y,{display:"flex",flexDirection:"column",px:12,py:6,gap:4,children:[e.jsx(I,{sx:{width:"190px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:h,IconComponent:()=>e.jsx(G,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"80%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,color:"primary",onChange:t=>x(t.target.value),children:E.map(t=>e.jsx(u,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:t,children:t},t))}),e.jsx(y,{height:"auto",display:"flex",gap:8,flexDirection:"row",flexWrap:"wrap",justifyContent:m!=null&&m.length?"":"center",children:m!=null&&m.length?m:e.jsx(p,{sx:{p:8},fontFamily:"Inter",fontSize:16,fontWeight:500,textAlign:"center",alignSelf:"center",children:"No Consultations yet."})})]})]})})}export{de as default};
