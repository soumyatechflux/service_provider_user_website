import{U as z,V as E,W as v,ab as M,X as R,D as q,l as H,r as m,A as Q,q as p,n as B,f as S,o as D,j as n,B as h,k as x,a6 as A,T as r,a as b,S as P,M as X,ac as L}from"./index-BLDXZsNf.js";import{d as N}from"./ExpandMore-uAOPnDwe.js";import{g as U}from"./getStudentConsultation-C9dgCfFu.js";import{s as F,a as K}from"./setRescheduleConsultation-yyQ7rzss.js";const $=async d=>{const t=z(q,"teachers"),l=E(t,v(M(),"in",d));return(await R(l)).docs.map(g=>({...g.data(),id:g.id}))},j=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Z(){const d=H(),{userData:t}=m.useContext(Q),[l,w]=m.useState(j[p.now().toDate().getDay()]),u=B(),g=m.useMemo(()=>{const e=p.now().toDate(),o=e.getDay(),a=(j.indexOf(l)-o+7)%7;return e.setDate(e.getDate()+a),e},[l]),{data:i}=S({queryKey:["studentConsultations",t==null?void 0:t.id],queryFn:()=>U(t==null?void 0:t.id),enabled:!!(t!=null&&t.id)}),{data:y}=S({queryKey:["teachersData",t==null?void 0:t.id],queryFn:()=>$(i==null?void 0:i.map(e=>e==null?void 0:e.teacherId)),enabled:!!i}),{mutate:T}=D({onMutate:e=>{const o=d.getQueryData(["studentConsultations",t==null?void 0:t.id]);return d.setQueryData(["studentConsultations",t==null?void 0:t.id],s=>s?s.slice().filter(f=>f.id!==e):[]),()=>d.setQueryData(["studentConsultations",t==null?void 0:t.id],o)},mutationFn:e=>F(e)}),{mutate:I}=D({onMutate:e=>{const o=d.getQueryData(["studentConsultations",t==null?void 0:t.id]);return d.setQueryData(["studentConsultations",t==null?void 0:t.id],s=>s?s.slice().filter(f=>f.id!==e):[]),()=>d.setQueryData(["studentConsultations",t==null?void 0:t.id],o)},mutationFn:e=>K(e)}),W=e=>{console.log(e),window.location.href=e};m.useEffect(()=>{(async()=>{if(i){const s=i.slice().filter(a=>{var C;const f=p.now().seconds-((C=a==null?void 0:a.endTime)==null?void 0:C.seconds),k=7*24*60*60;return f>=k}).map(async a=>{await F(a.id)});await Promise.all(s)}})()},[i]);const c=i==null?void 0:i.slice().filter(e=>e.status==="accepted").filter(e=>e.startTime.toDate().getDate()===g.getDate()).map(e=>{const o=y==null?void 0:y.find(s=>s.id===(e==null?void 0:e.teacherId));return n.jsxs(h,{display:"flex",flexDirection:"column",justifyContent:"space-between",px:3,py:1,bgcolor:"#D0EBFC",borderRadius:"10px",overflow:"hidden",boxShadow:"0px 2px 4px 0px rgba(0, 0, 0, 0.25)",children:[n.jsxs(x,{direction:"row",gap:1,mr:7,children:[n.jsx(A,{onClick:()=>u(`/teacherprofile/${teacherData==null?void 0:teacherData.id}`),src:o==null?void 0:o.image,sx:{width:"41px",height:"41px",border:"1px solid #226E9F",cursor:"pointer"}}),n.jsxs(x,{direction:"column",justifyContent:"center",gap:.5,children:[n.jsx(r,{onClick:()=>u(`/teacherprofile/${teacherData==null?void 0:teacherData.id}`),sx:{color:"#226E9F",cursor:"pointer"},fontFamily:"Inter",fontSize:12,fontWeight:600,children:o==null?void 0:o.name}),n.jsxs(r,{fontFamily:"Inter",fontSize:10,fontWeight:400,children:[o==null?void 0:o.title," | Cairo, Egypt"]})]})]}),n.jsxs(x,{direction:"row",justifyContent:"space-between",mt:4,mb:3,children:[n.jsx(r,{fontSize:14,fontWeight:500,fontFamily:"Inter",children:e.startTime.toDate().toLocaleDateString("en-GB")}),n.jsxs(x,{direction:"row",alignItems:"center",children:[n.jsx(r,{fontSize:16,fontWeight:600,fontFamily:"Inter",children:e.startTime.toDate().getHours()>12?e.startTime.toDate().getHours()%12:e.startTime.toDate().getHours()}),n.jsxs(r,{sx:{marginTop:"5px"},fontSize:8,fontWeight:400,fontFamily:"Inter",children:[e.startTime.toDate().getHours()>12?"PM":"AM","-"]}),n.jsx(r,{fontSize:16,fontWeight:600,fontFamily:"Inter",children:e.endTime.toDate().getHours()>12?e.endTime.toDate().getHours()%12:e.endTime.toDate().getHours()}),n.jsx(r,{sx:{marginTop:"5px"},fontSize:8,fontWeight:400,fontFamily:"Inter",children:e.endTime.toDate().getHours()>12?"PM":"AM"})]})]}),p.now().toDate()>=e.startTime.toDate()&&p.now().toDate()<=e.endTime.toDate()?n.jsx(x,{width:"140px",alignSelf:"center",mb:1,children:n.jsx(b,{sx:{padding:.5,border:"0px",background:"#00B227",color:"#fff",paddingX:1},onClick:()=>W(e==null?void 0:e.meetingLink),children:n.jsx(r,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:400,fontFamily:"Inter",children:"Join Consultation"})})}):n.jsxs(x,{mb:1,direction:"row",justifyContent:"space-between",children:[n.jsx(b,{sx:{padding:.5,border:"0px",background:"#226E9F",color:"#fff",paddingX:1,width:"100px"},onClick:()=>I(e.id),children:n.jsx(r,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:400,fontFamily:"Inter",children:"Reschedule"})}),n.jsx(b,{sx:{padding:.5,border:"0px",background:"#D9D9D9",color:"#000",paddingX:1,width:"70px"},onClick:()=>T(e.id),children:n.jsx(r,{noWrap:!0,sx:{textTransform:"none"},fontSize:14,fontWeight:500,fontFamily:"Inter",children:"Cancel"})})]})]})});return n.jsxs(h,{mx:14,borderRadius:"20px",overflow:"hidden",height:"auto",boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.25)",children:[n.jsx(h,{p:2,px:4,bgcolor:"#D0EBFC",children:n.jsx(r,{fontWeight:900,fontFamily:"Inter",fontSize:24,children:"Consultations"})}),n.jsxs(h,{display:"flex",flexDirection:"column",px:12,py:6,gap:4,children:[n.jsx(P,{sx:{width:"190px !important",height:"38px !important",boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",borderRadius:"7.5px !important",outline:"none !important",boxSizing:"border-box !important",background:"#fff",paddingX:1,"&:hover":{boxShadow:"0px 0px 0px 1px rgba(34,110,159,0.39)",background:"#fff"},fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:l,IconComponent:()=>n.jsx(N,{sx:{borderLeft:"1.5px solid rgba(34,110,159, 0.2)",paddingLeft:1,height:"100%",zIndex:1,position:"absolute",left:"80%"}}),inputProps:{style:{borderRight:"1px solid rgba(0, 0, 0, 1)",width:"100%"}},variant:"standard",disableUnderline:!0,color:"primary",onChange:e=>w(e.target.value),children:j.map(e=>n.jsx(X,{sx:{background:"#fff",fontSize:16,fontWeight:700,fontFamily:"Inter",color:"#226E9F"},value:e,children:e},e))}),n.jsx(h,{height:"auto",display:"flex",gap:8,flexDirection:"row",flexWrap:"wrap",justifyContent:c!=null&&c.length?"":"center",children:c!=null&&c.length?c:n.jsxs(r,{sx:{p:8},fontFamily:"Inter",fontSize:16,fontWeight:500,textAlign:"center",alignSelf:"center",children:["No booked consultations yet.",n.jsx("br",{}),n.jsx(L,{style:{color:"#226E9F",textDecoration:"none",fontWeight:700,cursor:"pointer"},to:"/instructors",children:"Search"})," for teachers & start booking."]})})]})]})}export{Z as default};
