import{U as F,D as j,V as v,av as S,aw as b,ax as q,a8 as g,W as i,X as W,r as m,O as B,A as H,C as I,f as y,ay as z,j as t,B as E,k as c,a6 as L,T as p,P as N,F as T}from"./index-BLDXZsNf.js";const k=async(r,a)=>{const d=F(j,"messages"),u=v(d,q(g(i("sender","==",r),i("receiver","==",a)),g(i("receiver","==",r),i("sender","==",a))),b("createdAt","desc"),S(1)),o=await W(u);return{...o.docs[0].data(),id:o.docs[0].id}};function K({id:r,search:a,searchFriends:d}){const{setChat:u}=m.useContext(B),{userData:o}=m.useContext(H),x=I(j,o.role==="teacher"?"students":"teachers",r);async function l(h){const s=await T(h);return s.exists()?{...s.data(),id:s.id}:{}}const{data:n,refetch:w}=y({queryKey:["chatUserData",r],queryFn:()=>l(x)}),{data:e,refetch:C}=y({queryKey:["lastMessageChat",r],queryFn:()=>k(o.id,r)}),f=(e==null?void 0:e.createdAt.toDate().getHours())>=12?(e==null?void 0:e.createdAt.toDate().getHours())%12===0?"12":(e==null?void 0:e.createdAt.toDate().getHours())%12:e==null?void 0:e.createdAt.toDate().getHours(),A=(e==null?void 0:e.createdAt.toDate().getHours())>=12?"PM":"AM",D=e==null?void 0:e.createdAt.toDate().getMinutes().toString().padStart(2,"0");return m.useEffect(()=>{const h=z(x,s=>{s.exists&&(w(),C())});return()=>{h()}},[]),!o||!n?t.jsx(t.Fragment,{}):a&&!(n!=null&&n.name.toLowerCase().includes(d.toLowerCase()))?t.jsx(t.Fragment,{}):t.jsxs(E,{display:"flex",flexDirection:"row",width:"97.5%",justifyContent:"space-between",px:2.5,py:3,gap:3,sx:{cursor:"pointer",borderBottom:"1px solid rgba(0, 0, 0, 0.2)"},onClick:()=>u([o,n]),children:[t.jsxs(c,{direction:"row",gap:2,alignItems:"center",children:[t.jsx(L,{src:(n==null?void 0:n.image)??"",sx:{width:"70px",height:"70px"}}),t.jsxs(c,{direction:"column",justifyContent:"center",gap:1,children:[t.jsx(p,{noWrap:!0,sx:{color:"#000"},fontFamily:"Inter",fontSize:14,fontWeight:600,children:n==null?void 0:n.name}),t.jsx(c,{direction:"row",justifyContent:"space-between",gap:1,children:t.jsxs(p,{noWrap:!0,fontFamily:"Inter",fontSize:12,fontWeight:700,children:[e==null?void 0:e.message.slice(0,30),(e==null?void 0:e.message.length)>30?"...":""]})})]})]}),t.jsxs(c,{alignItems:"center",justifyContent:"center",children:[(e==null?void 0:e.receiver)===o.id&&(e==null?void 0:e.read)===!1&&t.jsx(N,{sx:{marginTop:1,fontSize:10},children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",children:t.jsx("circle",{cx:"6.5",cy:"6.5",r:"6.5",fill:"#226E9F"})})}),t.jsxs(p,{sx:{marginTop:"auto"},fontSize:12,fontWeight:500,fontFamily:"Inter",children:[f,!isNaN(f)&&":",D,!isNaN(f)&&A]})]})]},r)}export{K as default};
