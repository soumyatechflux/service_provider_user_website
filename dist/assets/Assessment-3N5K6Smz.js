import{r as d,A as H,l as J,n as U,f as C,o as V,p as X,q as Y,j as o,B as m,k as N,T as A,E as O,t as q,v as Z,w as _,L as tt,C as z,D as $,F as k,y as et,z as st}from"./index-BLDXZsNf.js";function at(){var x,p,g,y,S,j;const{userData:c}=d.useContext(H),l=J(),h=U(),[a,B]=d.useState(),{data:n,isLoading:K}=C({queryKey:["examSession"],queryFn:()=>st(c.id)}),{mutate:R}=V({onMutate:()=>{const s=l.getQueryData(["examSession"]);return l.setQueryData(["examSession"],()=>[]),()=>l.setQueryData(["examSession"],s)},mutationFn:()=>P()}),f=(p=(x=n[0])==null?void 0:x.startTime)==null?void 0:p.toDate(),u=(y=(g=n[0])==null?void 0:g.endTime)==null?void 0:y.toDate(),{id:L}=X(),W=async s=>{const e=z($,"assessments",s),i=await k(e);return{...i.data(),id:i.id}},{data:t}=C({queryKey:["examSessionAssessment"],queryFn:()=>W(L??"")}),P=async()=>{var i,r;const s=z($,"courses",t==null?void 0:t.courseId),e=await k(s);await et(((i=n[0])==null?void 0:i.id)??"",c.id,`/programs/current/${(r=e.data())==null?void 0:r.programId}`)};d.useEffect(()=>{const s=setInterval(()=>{if(f&&u){const e=u-Y.now().toMillis();e>0?B(e):(R(),h("/"))}},1e3);return()=>clearInterval(s)},[f,u,a]);const G=async()=>{t!=null&&t.id&&await tt(c.id,t.id),await l.invalidateQueries({queryKey:["examSession"]}),h("/")};return K?o.jsx(o.Fragment,{}):o.jsxs(m,{width:"100%",position:"relative",children:[o.jsxs(N,{justifyContent:"space-between",direction:"row",children:[o.jsx(N,{direction:"column",bgcolor:"#D0EBFC",px:12,py:4,children:o.jsx(A,{sx:{color:"#FF7E00"},fontSize:16,fontFamily:"Inter",fontWeight:800,children:"Assessment"})}),o.jsx(m,{boxShadow:"0px 4px 4px 0px rgba(0, 0, 0, 0.25)",textAlign:"center",borderRadius:"15px",mr:14,mt:4,display:"flex",justifyContent:"center",alignItems:"center",height:"60px",width:"180px",children:o.jsxs(A,{fontSize:16,fontFamily:"Inter",fontWeight:500,children:[a?Math.floor(a/(1e3*60*60)).toString().length>1?Math.floor(a/(1e3*60*60)):`0${a&&Math.floor(a/(1e3*60*60))}`:"00",":",a?Math.floor(a%(1e3*60*60)/(1e3*60)).toString().length>1?Math.floor(a%(1e3*60*60)/(1e3*60)):`0${a&&Math.floor(a%(1e3*60*60)/(1e3*60))}`:"00",":",a?Math.floor(a%(1e3*60)/1e3).toString().length>1?Math.floor(a%(1e3*60)/1e3):`0${a&&Math.floor(a%(1e3*60)/1e3)}`:"00"]})})]}),o.jsx(m,{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:((S=t==null?void 0:t.questions)==null?void 0:S.length)&&((j=t==null?void 0:t.questions)==null?void 0:j.map((s,e)=>{var i,r,E,b,w,D,Q,I,F,M,T,v;return s.type==="options"?s.correctOption.length>1?o.jsx(O,{hidden:e!==Number((i=n[0])==null?void 0:i.lastQuestion),assessmentId:t.id,question:s,index:e,total:(r=t==null?void 0:t.questions)==null?void 0:r.length},e):o.jsx(q,{hidden:e!==Number((E=n[0])==null?void 0:E.lastQuestion),assessmentId:t.id,question:s,index:e,total:(b=t==null?void 0:t.questions)==null?void 0:b.length},e):s.type==="fiveOptions"?s.correctOption.length>2?o.jsx(Z,{hidden:e!==Number((w=n[0])==null?void 0:w.lastQuestion),assessmentId:t.id,question:s,index:e,total:(D=t==null?void 0:t.questions)==null?void 0:D.length},e):s.correctOption.length>1?o.jsx(O,{hidden:e!==Number((Q=n[0])==null?void 0:Q.lastQuestion),assessmentId:t.id,question:s,index:e,total:(I=t==null?void 0:t.questions)==null?void 0:I.length},e):o.jsx(q,{hidden:e!==Number((F=n[0])==null?void 0:F.lastQuestion),assessmentId:t.id,question:s,index:e,total:(M=t==null?void 0:t.questions)==null?void 0:M.length},e):o.jsx(_,{hidden:e!==Number((T=n[0])==null?void 0:T.lastQuestion),assessmentId:t.id,question:s,index:e,total:(v=t==null?void 0:t.questions)==null?void 0:v.length},e)}))}),o.jsx("div",{className:"absolute flex flex-col gap-2 w-fit text-left items-end justify-end text-[#FF7E00] font-[Inter] bottom-10 left-5 z-50",children:o.jsx("button",{className:"bg-[#FF7E00] text-white px-4 py-2 rounded-md",onClick:()=>G(),children:"Exit Exam"})})]})}export{at as default};
